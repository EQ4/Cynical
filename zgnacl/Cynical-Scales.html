<!DOCTYPE html>
<html>
<head>
	<title>Cynical - Earthquake</title>
	<link rel="stylesheet" href="http://code.jquery.com/ui/1.8.18/themes/base/jquery-ui.css" type="text/css" media="all" />
	<link rel="stylesheet" href="http://static.jquery.com/ui/css/demo-docs-theme/ui.theme.css" type="text/css" media="all" />
	<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" type="text/javascript"></script>
	<script src="http://code.jquery.com/ui/1.8.18/jquery-ui.min.js" type="text/javascript"></script>
	<script src="http://jquery-ui.googlecode.com/svn/tags/latest/external/jquery.bgiframe-2.1.2.js" type="text/javascript"></script>
	<script src="http://jquery-ui.googlecode.com/svn/tags/latest/ui/minified/i18n/jquery-ui-i18n.min.js" type="text/javascript"></script>
	
	<style>
		#parent {  
			width: 1200px;
			text-align: center;  
			font-size: 12px;  
			letter-spacing: 0px;  
			white-space: nowrap;  
			line-height: 12px;  
			overflow: hidden;  
			color:white;
			font-family:arial,sans-serif;
		}  
		
		.child {
			display: inline-block;  
			vertical-align: middle;  
		}
		
		h2 {
			color:white;
			font-family:arial,sans-serif;
		}
		
		.step {
			background-image: url('gfx/step-on.png');
			width: 32px;
			height: 32px;
			float:left;
			opacity:1;
		}
		
		.row1 {
			background-color: rgb(128,128,128);
			width: 512px;
			height: 32px;
			float:left;
			opacity:1;
			z-index: 100;
		}

	</style>
	
	<style>
		#demo-frame > div.demo { 
			padding: 10px !important; 
		}
		#eq span {
			height:120px; 
			float:left; 
			margin:15px
		}
		
		#slider-labels span {
			height:20px; 
			float:left; 
			margin:15px;
			width:15px;
			font-size: 12px;
			color: white;
			text-align: center;
			font-family:arial,sans-serif;
		}
	</style>
	<script type="text/javascript">
    ZgnaclModule = null;  // Global application object.
			
    var loadPdPatch = function(url, callback){
        var args = Array.prototype.slice.call(arguments, 2);
        var loader = new XMLHttpRequest();
        var onLoad = function(e){
    	console.log(e);
        };
        loader.onreadystatechange = function(e){
    	if (e.target.readyState == 4) {
    	    callback.apply(callback, arguments);
    	}
        };
        loader.open("GET", url, false);
        loader.send(null);
    };
    
    function onPdPatchLoad(evt) {
        console.log(evt);
        ZgnaclModule.postMessage("newGraph: " + evt.target.responseText);
        ZgnaclModule.postMessage('playSound');
    }

    // When the NaCl module has loaded, hook up an event listener to handle
    // messages coming from it via PPB_Messaging.PostMessage() (in C) or
    // pp::Instance.PostMessage() (in C++), and indicate success.
    function moduleDidLoad() {
      ZgnaclModule = document.getElementById('zgnacl');
      ZgnaclModule.addEventListener('message', handleMessage, false);
      loadPdPatch("./osc2.pd", onPdPatchLoad);
      updateStatus('Click and drag in the grey space on the right');
      
      // 
      document.getElementById('mouseArea').addEventListener('mousemove', sendMouseToZG, true); 
      document.getElementById('mouseArea').addEventListener('mousedown', sendMouseDownToZG, true);
      document.addEventListener('mouseup', sendMouseDownToZG, true);
     // document.getElementById('mouseArea').addEventListener('click', function(e){console.log(e);}, true);
    }
    
    function sendMouseToZG(e) {
       console.log(e.x, e.y);
       var stringToPost = "sendMessage:mouseY:0.0:"+ e.y;
       ZgnaclModule.postMessage(stringToPost);
       var stringToPost = "sendMessage:mouseX:0.0:"+ e.x;
       ZgnaclModule.postMessage(stringToPost);
    }
    
    function sendMouseDownToZG(m) {
       console.log(m.type);
       if (m.type == 'mousedown') {
       	var stringToPost = "sendMessage:mouseDown:0.0:1";
       }else{
       	var stringToPost = "sendMessage:mouseDown:0.0:0";
       }
       ZgnaclModule.postMessage(stringToPost);
       console.log('Sending: '+ stringToPost);
    }
    
    function sendScaleToZG(scale) {
       console.log(scale.value);
       var stringToPost = "sendMessage:scaleSelector:0.0:" + scale.value;
       ZgnaclModule.postMessage(stringToPost);
       console.log(stringToPost);
    }
    
    function sendKeyToZG(key) {
       console.log(key.value);
       var stringToPost = "sendMessage:keySelector:0.0:" + key.value;
       ZgnaclModule.postMessage(stringToPost);
       console.log(stringToPost);
    }

    // The 'message' event handler.  This handler is fired when the NaCl module
    // posts a message to the browser by calling PPB_Messaging.PostMessage()
    // (in C) or pp::Instance.PostMessage() (in C++).  This implementation
    // simply displays the content of the message in an alert panel.
    function handleMessage(message_event) {
      //alert(message_event.data);
      console.log(message_event.data);
    }
    
    function pageDidLoad() {
      if (ZgnaclModule == null) {
        updateStatus('Loading synth... (may take up to a minute)');
      } else {
        // It's possible that the Native Client module onload event fired
        // before the page's onload event.  In this case, the status message
        // will reflect 'SUCCESS', but won't be displayed.  This call will
        // display the current message.
        updateStatus();
      }
    }

    // Set the global status message.  If the element with id 'statusField'
    // exists, then set its HTML to the status message as well.
    // opt_message The message test.  If this is null or undefined, then
    // attempt to set the element with id 'statusField' to the value of
    // |statusText|.
    function updateStatus(opt_message) {
      if (opt_message)
        statusText = opt_message;
      var statusField = document.getElementById('status_field');
      if (statusField) {
        statusField.innerHTML = statusText;
      }
    }
    
    function toggleSound(flag) {
      if (flag) {
        ZgnaclModule.postMessage('playSound');
      } else {
        ZgnaclModule.postMessage('stopSound');
      }
    }
    
    $(function() {
		// setup master volume
		$( "#master" ).slider({
			value: 60,
			orientation: "horizontal",
			range: "min",
			animate: true
		});
		// setup graphic EQ
		$( "#eq > span" ).each(function() {
			// read initial values from markup and remove that
			var value = parseInt( $( this ).text(), 10 );
			$( this ).empty().slider({
				value: value,
				range: "min",
				animate: true,
				orientation: "vertical",
				change: updateParams,
				slide: updateParams,
			});
		});
	});
			
	function updateParams() {
		var slider1 = $( "#slider1" ).slider( "value" );
		var messageToSend = 'sendMessage:slider1s:0:'+slider1;
		ZgnaclModule.postMessage(messageToSend);
		var slider2 = $( "#slider2" ).slider( "value" );
		var messageToSend2 = 'sendMessage:slider2s:0:'+slider2;
		ZgnaclModule.postMessage(messageToSend2);
		var slider3 = $( "#slider3" ).slider( "value" );
		var messageToSend3 = 'sendMessage:slider3s:0:'+slider3;
		ZgnaclModule.postMessage(messageToSend3);
		var slider4 = $( "#slider4" ).slider( "value" );
		var messageToSend4 = 'sendMessage:slider4s:0:'+slider4;
		ZgnaclModule.postMessage(messageToSend4);
		var slider5 = $( "#slider5" ).slider( "value" );
		var messageToSend5 = 'sendMessage:slider5s:0:'+slider5;
		ZgnaclModule.postMessage(messageToSend5);
		var slider6 = $( "#slider6" ).slider( "value" );
		var messageToSend6 = 'sendMessage:slider6s:0:'+slider6;
		ZgnaclModule.postMessage(messageToSend6);
		var slider7 = $( "#slider7" ).slider( "value" );
		var messageToSend7 = 'sendMessage:slider7s:0:'+slider7;
		ZgnaclModule.postMessage(messageToSend7);
		var slider8 = $( "#slider8" ).slider( "value" );
		var messageToSend8 = 'sendMessage:slider8s:0:'+slider8;
		ZgnaclModule.postMessage(messageToSend8);
		var slider9 = $( "#slider9" ).slider( "value" );
		var messageToSend9 = 'sendMessage:slider9s:0:'+slider9;
		ZgnaclModule.postMessage(messageToSend9);
		var slider10 = $( "#slider10" ).slider( "value" );
		var messageToSend10 = 'sendMessage:slider10s:0:'+slider10;
		ZgnaclModule.postMessage(messageToSend10);
		var slider11 = $( "#slider11" ).slider( "value" );
		var messageToSend11 = 'sendMessage:slider11s:0:'+slider11;
		ZgnaclModule.postMessage(messageToSend11);
	}
        
	function sendMessage(receiverName, messageString) {
	  ZgnaclModule.postMessage("sendMessage:" + receiverName + ":0:" + messageString);
	  console.log(messageString);
	}

	function sendMessageWithTimestamp(receiverName, timestamp, messageString) {
	  ZgnaclModule.postMessage("sendMessage:" + receiverName + ":" + timestamp + ":" + messageString);
	}

	function registerReceiver(receiverName) {
	  ZgnaclModule.postMessage("registerReceiver:" + receiverName);
	}
	
	function unregisterReceiver(receiverName) {
	  ZgnaclModule.postMessage("unregisterReceiver:" + receiverName);
	}
  </script>
</head>
<body style="background: url('http://static.tumblr.com/jhhfv1l/UA5lqp7o2/sky.jpg') fixed; width:98%;">
<!--
<button onclick="toggleSound(true)">Play</button>
<button onclick="toggleSound(false)">Stop</button>
-->
  <div id="listener">
    <script type="text/javascript">
       document.getElementById('listener').addEventListener('load', moduleDidLoad, true);
    </script>

    <embed name="nacl_module"
       id="zgnacl"
       width=0 height=0
       src="zgnacl_dbg.nmf" 
       type="application/x-nacl" />
  </div>
  </br>
	<center>
		<div id="title" style="opacity:1; width:780px; height:89PX; background-image:url('gfx/juno-title.png');"></div>
	<center>
  </br>
	<div style="width: 1200px; margin: 0 auto 0 auto;">
		<div id="parent">
		  <div class="child">
		  	<p class="child">Scale</p>
			<select class="child" id="scaleSelector" onchange="sendScaleToZG(this);">
				<option value="Chromatic">Chromatic</option>
				<option value="Blues">Blues</option>
				<option value="BluesDiminished">Blues Diminished</option>
				<option value="Dorian">Dorian</option>
				<option value="FullMinor">Full Minor</option>
				<option value="HarmonicMajor">Harmonic Major</option>
				<option value="Hawaiian">Hawaiian</option>
				<option value="IonianSharp5">Ionian Sharp 5</option>
				<option value="JazzMinor">Jazz Minor</option>
				<option value="Lydian">Lydian</option>
				<option value="Major">Major</option>
				<option value="Mixolydian">Mixolydian</option>
				<option value="Oriental">Oriental</option>
				<option value="SuperLocrian">Super Locrian</option>
				<option value="VerdiEnigmaticAscending">Verdi Enigmatic Ascending</option>
				<option value="Zirafkend">Zirafkend</option>
			</select>
		  	<p class="child">Key</p>
			<select class="child" id="keySelector" onchange="sendKeyToZG(this);">
				<option value="0">C</option>
				<option value="1">C#</option>
				<option value="2">D</option>
				<option value="3">D#</option>
				<option value="4">E</option>
				<option value="5">F</option>
				<option value="6">F#</option>
				<option value="7">G</option>
				<option value="8">G#</option>
				<option value="9">A</option>
				<option value="10">A#</option>
				<option value="11">B</option>
			</select>
			<!--
			<div id="step-sequencer">
				<div id="row1">
					<div class="step" id="1"></div>
					<div class="step" id="2"></div>
					<div class="step" id="3"></div>
					<div class="step" id="4"></div>
					<div class="step" id="5"></div>
					<div class="step" id="6"></div>
					<div class="step" id="7"></div>
					<div class="step" id="8"></div>
					<div class="step" id="9"></div>
					<div class="step" id="10"></div>
					<div class="step" id="11"></div>
					<div class="step" id="12"></div>
					<div class="step" id="13"></div>
					<div class="step" id="14"></div>
					<div class="step" id="15"></div>
					<div class="step" id="16"></div>
				</div>
			</div>
			-->
		  </div>
		</div>
		<div id="eq" class="child">
			<span id="slider1">100</span>
			<span id="slider2">100</span>
			<span id="slider3">0</span>
			<span id="slider4">33</span>
			<span id="slider5">40</span>
			<span id="slider6">45</span>
			<span id="slider7">70</span>
			<span id="slider8">33</span>
			<span id="slider9">0</span>
			<span id="slider10">45</span>
			<span id="slider11">0</span>
		</div>
		<div style="clear:both;"></div>
		<div id="slider-labels" class="child">
			<span>Volume</span>
			<span>OSC 1</span>
			<span>OSC 2</span>
			<span>Freq</span>
			<span>A</span>
			<span>D</span>
			<span>S</span>
			<span>R</span>
			<span>Delay</span>
			<span>Trem Rate</span>
			<span>Trem Depth</span>
		</div>
		<div style="clear:both;"><div>
		<div id="mouseArea" style="opacity:1; width:790px; height:235PX; background-image:url('gfx/juno.png');"></div>

		</div>
  	<div style="position:absolute; bottom:5px;">
  		<img src="http://reactifymusic.com/Cynical-Lab/chrome-trans.png">
  	</div>
</body>
</html>
